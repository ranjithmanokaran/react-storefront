{"version":3,"sources":["../../../src/mock-connector/utils/cartStore.js"],"names":["CART_COOKIE","initialStore","id","quantity","getStore","req","res","cookies","setHeader","JSON","stringify","store","parse","err","console","log","toProduct","getProducts","map","updateItem","newStore","item","find","e","removeItem","filter","addItem"],"mappings":"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","sourcesContent":["import createProduct from './createProduct'\n\nconst CART_COOKIE = 'rsf_mock_cart'\n\nconst initialStore = [\n  { id: 1, quantity: 1 },\n  { id: 2, quantity: 1 },\n]\n\nfunction getStore(req, res) {\n  if (!req.cookies[CART_COOKIE]) {\n    res.setHeader('Set-Cookie', `${CART_COOKIE}=${JSON.stringify(initialStore)}; Path=/`)\n  }\n  const store = req.cookies[CART_COOKIE] || initialStore\n  try {\n    return JSON.parse(store)\n  } catch (err) {\n    console.log('Failed parsing store from cookie', req.cookies[CART_COOKIE])\n    return []\n  }\n}\n\nfunction toProduct({ id, quantity }) {\n  return { ...createProduct(id), quantity }\n}\n\nexport function getProducts(req, res) {\n  return getStore(req, res).map(toProduct)\n}\n\nexport function updateItem(id, quantity, req, res) {\n  const newStore = [...getStore(req, res)]\n  const item = newStore.find(e => e.id === id)\n  item.quantity = quantity\n  res.setHeader('Set-Cookie', `${CART_COOKIE}=${JSON.stringify(newStore)}; Path=/`)\n  return newStore.map(toProduct)\n}\n\nexport function removeItem(id, req, res) {\n  const newStore = [...getStore(req, res)].filter(e => e.id !== id)\n  res.setHeader('Set-Cookie', `${CART_COOKIE}=${JSON.stringify(newStore)}; Path=/`)\n  return newStore.map(toProduct)\n}\n\nexport function addItem(id, quantity, req, res) {\n  const newStore = [{ id, quantity }, ...getStore(req, res)]\n  res.setHeader('Set-Cookie', `${CART_COOKIE}=${JSON.stringify(newStore)}; Path=/`)\n  return newStore.map(toProduct)\n}\n"],"file":"cartStore.js"}