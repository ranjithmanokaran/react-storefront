{"version":3,"sources":["../../src/mock-connector/subcategory.js"],"names":["subcategory","params","req","res","q","slug","page","filters","sort","more","JSON","parse","appData","createAppData","pageData","Promise","resolve","id","name","title","total","parseInt","totalPages","sortOptions","facets","products","filterProducts","breadcrumbs","text","href","filteredColors","filter","f","startsWith","map","replace","count","length","color","index","colorGap","i","Math","floor","push","Array","from","v","Object","keys","colors","a","b","slice"],"mappings":"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","sourcesContent":["import createFacets from './utils/createFacets'\nimport createSortOptions from './utils/createSortOptions'\nimport createProduct from './utils/createProduct'\nimport colors, { indexForColor } from './utils/colors'\nimport fulfillAPIRequest from 'react-storefront/props/fulfillAPIRequest'\nimport createAppData from './utils/createAppData'\n\nexport default async function subcategory(params, req, res) {\n  let { q, slug = '1', page = 0, filters, sort, more = false } = params\n\n  if (filters) {\n    filters = JSON.parse(filters)\n  } else {\n    filters = []\n  }\n\n  return await fulfillAPIRequest(req, {\n    appData: createAppData,\n    pageData: () =>\n      Promise.resolve({\n        id: slug,\n        name: q != null ? `Results for \"${q}\"` : `Subcategory ${slug}`,\n        title: q != null ? `Results for \"${q}\"` : `Subcategory ${slug}`,\n        total: 100,\n        page: parseInt(page),\n        totalPages: 5,\n        filters,\n        sort,\n        sortOptions: createSortOptions(),\n        facets: createFacets(),\n        products: filterProducts(page, filters, more),\n        breadcrumbs: [\n          {\n            text: `Home`,\n            href: '/',\n          },\n        ],\n      }),\n  })\n}\n\nfunction filterProducts(page, filters, more) {\n  const products = []\n  const filteredColors = filters\n    ? filters.filter(f => f.startsWith('color')).map(f => f.replace(/^color:/, ''))\n    : []\n  const count = more ? 20 : 10\n\n  while (products.length < count) {\n    if (filteredColors && filteredColors.length) {\n      for (let color of filteredColors) {\n        const index = indexForColor(color)\n\n        const colorGap = i => Math.floor((page * count) / filteredColors.length) + i\n\n        products.push(\n          ...Array.from({ length: count }, (v, i) => colorGap(i)).map(i =>\n            createProduct('' + (i * Object.keys(colors).length + index)),\n          ),\n        )\n      }\n    } else {\n      const id = page * 10 + products.length + 1\n      products.push(createProduct(id + ''))\n    }\n  }\n\n  return products.sort((a, b) => a.id - b.id).slice(0, count)\n}\n"],"file":"subcategory.js"}