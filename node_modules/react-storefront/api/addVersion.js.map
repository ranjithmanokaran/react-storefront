{"version":3,"sources":["../../src/api/addVersion.js"],"names":["VERSION_PARAM","addVersion","url","appOrigin","window","location","href","URL","searchParams","has","__NEXT_DATA__","append","buildId"],"mappings":";;;;;;;;AAAA;;;;;AAKO,IAAMA,aAAa,GAAG,OAAtB;AAEP;;;;;;;;;AAMe,SAASC,UAAT,CAAoBC,GAApB,EAAyB;AACtC,MAAI,CAACA,GAAL,EAAU,OAAOA,GAAP;AAEV,MAAIC,SAAS,GAAG,sBAAhB;AAEA;;AACA,MAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AACjCD,IAAAA,SAAS,GAAGC,MAAM,CAACC,QAAP,CAAgBC,IAA5B;AACD;;AAED,MAAI,OAAOJ,GAAP,KAAe,QAAnB,EAA6B;AAC3BA,IAAAA,GAAG,GAAG,IAAIK,GAAJ,CAAQL,GAAR,EAAaC,SAAb,CAAN;AACD;AAED;;;AACA,MAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC,OAAOF,GAAP;;AAEnC,MAAI,CAACA,GAAG,CAACM,YAAJ,CAAiBC,GAAjB,CAAqBT,aAArB,CAAD,IAAwC,OAAOU,aAAP,KAAyB,WAArE,EAAkF;AAChFR,IAAAA,GAAG,CAACM,YAAJ,CAAiBG,MAAjB,CAAwBX,aAAxB,EAAuCU,aAAa,CAACE,OAArD;AACD;;AAED,SAAOV,GAAP;AACD","sourcesContent":["/**\n * The query param that is added to fetch alls to /api routes to ensure that\n * cached results from previous versions of the app are not served to new versions\n * of the app.\n */\nexport const VERSION_PARAM = '__v__'\n\n/**\n * Adds the next build id as the __v__ query parameter to the given url if\n * the hostname is the same as the URL from which the app was served.\n * @param {URL|string} url Any URL\n * @return {URL}\n */\nexport default function addVersion(url) {\n  if (!url) return url\n\n  let appOrigin = 'http://throwaway.api'\n\n  /* istanbul ignore else */\n  if (typeof window !== 'undefined') {\n    appOrigin = window.location.href\n  }\n\n  if (typeof url === 'string') {\n    url = new URL(url, appOrigin)\n  }\n\n  /* istanbul ignore next */\n  if (typeof window === 'undefined') return url\n\n  if (!url.searchParams.has(VERSION_PARAM) && typeof __NEXT_DATA__ !== 'undefined') {\n    url.searchParams.append(VERSION_PARAM, __NEXT_DATA__.buildId)\n  }\n\n  return url\n}\n"],"file":"addVersion.js"}